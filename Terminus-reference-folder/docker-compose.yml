---
# ============================================
# Terminus Docker Compose Configuration
# ============================================
# This file provides three deployment options:
# 1. Backend-only (API server for separate frontends)
# 2. Web (Full web application - RECOMMENDED)
# 3. Full (Web + Electron downloads)
#
# Uncomment the service you want to use

services:
  # ============================================
  # OPTION 1: Backend-Only
  # Use this for: Separate frontend deployment, API-only server
  # ============================================
  # terminus-backend:
  #   container_name: terminus-backend
  #   image: ghcr.io/snenjih/terminus:backend
  #   restart: unless-stopped
  #   ports:
  #     - "30001:30001"
  #   environment:
  #     - NODE_ENV=production
  #     - PORT=30001
  #     - DATA_DIR=/app/db/data
  #   volumes:
  #     - ./terminus-data:/app/db/data
  #     - ./terminus-uploads:/app/uploads
  #   labels:
  #     - "com.centurylinklabs.watchtower.enable=true"
  #   healthcheck:
  #     test: ["CMD", "node", "-e", "require('http').get('http://localhost:30001/', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
  #     interval: 30s
  #     timeout: 10s
  #     start_period: 40s
  #     retries: 3

  # ============================================
  # OPTION 2: Web (RECOMMENDED)
  # Use this for: Standard web deployment with UI
  # ============================================
  terminus-web:
    container_name: terminus
    # Multi-architecture image - Docker automatically selects the correct variant
    # Supports: linux/amd64 (Intel/AMD), linux/arm64 (ARM 64-bit)
    image: ghcr.io/snenjih/terminus:web
    # For local builds, uncomment below and comment image above:
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    #   target: web

    restart: unless-stopped

    ports:
      - "30001:30001"  # HTTP API and Web UI
      # - "8443:8443"  # HTTPS (uncomment if using SSL)

    environment:
      - NODE_ENV=production
      - PORT=30001
      - DATA_DIR=/app/db/data
      # - SSL_PORT=8443  # Uncomment if using SSL
      # - VERSION=1.0.0  # Optional: override version

    volumes:
      # SQLite database and configuration
      - ./terminus-data:/app/db/data
      # File uploads
      - ./terminus-uploads:/app/uploads
      # SSL certificates (optional)
      # - ./terminus-ssl:/app/ssl

    labels:
      - "com.centurylinklabs.watchtower.enable=true"

    healthcheck:
      test: ["CMD", "node", "-e", "require('http').get('http://localhost:30001/', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
      interval: 30s
      timeout: 10s
      start_period: 40s
      retries: 3

  # ============================================
  # OPTION 3: Full (Web + Electron Downloads)
  # Use this for: Complete deployment with desktop app downloads
  # ============================================
  # terminus-full:
  #   container_name: terminus-full
  #   image: ghcr.io/snenjih/terminus:full
  #   # For local builds, uncomment below and comment image above:
  #   # build:
  #   #   context: .
  #   #   dockerfile: Dockerfile
  #   #   target: full
  #
  #   restart: unless-stopped
  #
  #   ports:
  #     - "30001:30001"
  #     # - "8443:8443"  # HTTPS (uncomment if using SSL)
  #
  #   environment:
  #     - NODE_ENV=production
  #     - PORT=30001
  #     - DATA_DIR=/app/db/data
  #
  #   volumes:
  #     - ./terminus-data:/app/db/data
  #     - ./terminus-uploads:/app/uploads
  #     - ./terminus-downloads:/app/downloads  # Electron builds available here
  #     # - ./terminus-ssl:/app/ssl
  #
  #   labels:
  #     - "com.centurylinklabs.watchtower.enable=true"
  #
  #   healthcheck:
  #     test: ["CMD", "node", "-e", "require('http').get('http://localhost:30001/', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"]
  #     interval: 30s
  #     timeout: 10s
  #     start_period: 40s
  #     retries: 3

# ============================================
# Optional: Network Configuration
# ============================================
# networks:
#   terminus-network:
#     driver: bridge

# ============================================
# Optional: Volumes (for better control)
# ============================================
# volumes:
#   terminus-data:
#     driver: local
#   terminus-uploads:
#     driver: local
